#+TITLE: Emacs Configuration
#+AUTHOR: Nasser Alkmim
* Introduction
This conficuration was copied and modified from [[https://github.com/danielmai/.emacs.d][Daniel's configuration]].

Download [[http://vgoulet.act.ulaval.ca/en/emacs/windows/][Emacs]] from this site which includes the support for png, jpeg images. Or [[http://emacsbinw64.sourceforge.net/][From this site]].
  
This configuration uses the [[https://github.com/jwiegley/use-package][use-package]] package from John Wiegley, which is
a fantastic way to manage package configurations. This [[http://www.lunaryorn.com/2015/01/06/my-emacs-configuration-with-use-package.html][post]] explain how it works.

This [[http://emacs.stackexchange.com/questions/10396/difference-between-init-and-config-in-use-package][Question]] is useful to understand the differences between init and config. Basically, bind and init are evaluated immediately after start up which contributes to startup time, config is deferred until the pacakge is loaded (by a bind key or a specific mode).

Current load time 1.5s on windows.

* Personal information

 #+begin_src emacs-lisp
(setq user-full-name "Nasser Alkmim"
      user-mail-address "nasser.alkmim@gmail.com")
#+end_src


* Loading config.org

Using the method described here: http://www.holgerschurig.de/en/emacs-efficiently-untangling-elisp/
*** Package management

#+BEGIN_SRC emacs-lisp
(package-initialize nil)
(setq package-enable-at-startup nil)
#+END_SRC


#+BEGIN_SRC emacs-lisp
;;; Set up package
;; initalize all ELPA packages
(require 'package)
(setq package-enable-at-startup nil
      package-archives
      '(("melpa"           . "http://melpa.org/packages/")
        ("melpa-stable" . "http://stable.melpa.org/packages/")
        ("RSW-packages" . "http://www.plasmas.biz/rswe/")
        ("org" . "http://orgmode.org/elpa/")))
#+END_SRC

*** use-package

See [http://github.com/jwiegley/use-package/]
or http://www.lunaryorn.com/2015/01/06/my-emacs-configuration-with-use-package.html

Basic syntax:

#+BEGIN_EXAMPLE
(use-package package-name
	 [:keyword [option]]...)

:init          Code to run before PACKAGE-NAME has been loaded.
:config        Code to run after PACKAGE-NAME has been loaded.  Note that if
			   loading is deferred for any reason, this code does not execute
			   until the lazy load has occurred.
:preface       Code to be run before everything except `:disabled'; this can
			   be used to define functions for use in `:if', or that should be
			   seen by the byte-compiler.
:mode          Form to be added to `auto-mode-alist'.
:interpreter   Form to be added to `interpreter-mode-alist'.
:commands      Define autoloads for commands that will be defined by the
			   package.  This is useful if the package is being lazily loaded,
			   and you wish to conditionally call functions in your `:init'
			   block that are defined in the package.
:bind          Bind keys, and define autoloads for the bound commands.
:bind*         Bind keys, and define autoloads for the bound commands,
			   *overriding all minor mode bindings*.
:bind-keymap   Bind a key prefix to an auto-loaded keymap defined in the
			   package.  This is like `:bind', but for keymaps.
:bind-keymap*  Like `:bind-keymap', but overrides all minor mode bindings
:defer         Defer loading of a package -- this is implied when using
			   `:commands', `:bind', `:bind*', `:mode' or `:interpreter'.
			   This can be an integer, to force loading after N seconds of
			   idle time, if the package has not already been loaded.
:after         Defer loading of a package until after any of the named
			   features are loaded.
:demand        Prevent deferred loading in all cases.
:if EXPR       Initialize and load only if EXPR evaluates to a non-nil value.
:disabled      The package is ignored completely if this keyword is present.
:defines       Declare certain variables to silence the byte-compiler.
:functions     Declare certain functions to silence the byte-compiler.
:load-path     Add to the `load-path' before attempting to load the package.
:diminish      Support for diminish.el (if installed).
:ensure        Loads the package using package.el if necessary.
:pin           Pin the package to an archive.
#+END_EXAMPLE

#+BEGIN_SRC emacs-lisp
(unless (package-installed-p 'use-package)
  (package-refresh-contents)
  (package-install 'use-package))

(eval-when-compile
  (require 'use-package))
(require 'diminish)                ;; if you use :diminish
(require 'bind-key)
(setq use-package-verbose t)
#+END_SRC


* Custom settings

#+BEGIN_SRC emacs-lisp
(setq custom-file (expand-file-name "custom.el" user-emacs-directory))
(load custom-file)
#+END_SRC


* Theme
*** Doom theme 


#+BEGIN_SRC emacs-lisp :tangle no
(use-package doom-themes
  :ensure t
  :diminish doom-buffer-mode
  :init (load-theme 'doom-one t)
  :config
  ;;; OPTIONAL
  ;; brighter source buffers
  (add-hook 'find-file-hook 'doom-buffer-mode)
  ;; brighter minibuffer when active
  (add-hook 'minibuffer-setup-hook 'doom-brighten-minibuffer)

  ;; Custom neotree theme
  ;; (require 'doom-neotree)
  ;; (setq doom-neotree-enable-file-icons nil)

  ;; org mode configs
  (setq org-fontify-whole-heading-line t
      org-fontify-done-headline t
      org-fontify-quote-and-verse-blocks t)

  ;;  use it to visually set apart source buffers from popups, the minibuffer, or temporary buffers.
  (add-hook 'find-file-hook 'doom-buffer-mode)
  (use-package all-the-icons
    :load-path "C:/Users/Nasser/.emacs.d/elpa/all-the-icons"))
#+END_SRC



*** Moe theme 

#+BEGIN_SRC emacs-lisp :tangle no
(use-package moe-theme
  :ensure t
  :config
  (setq moe-theme-highlight-buffer-id t)
  (setq moe-light-pure-white-background-in-terminal t)
  (use-package moe-theme-switcher))
#+END_SRC


*** Tao theme

#+BEGIN_SRC emacs-lisp :tangle no
(use-package tao-theme
  :ensure t
  :defer t)
#+END_SRC



*** Leuven theme

#+BEGIN_SRC emacs-lisp :tangle no
(use-package leuven-theme
  :ensure t
  :defer t)
#+END_SRC


*** Anti Zenburn

#+BEGIN_SRC emacs-lisp :tangle no
(use-package anti-zenburn-theme
  :ensure t
  :defer t )
#+END_SRC


*** Cyberpunk theme

#+BEGIN_SRC emacs-lisp :tangle no
(use-package cyberpunk-theme
  :defer t
  :ensure t)
#+END_SRC


*** Zenburn

#+BEGIN_SRC emacs-lisp :tangle no
(use-package zenburn-theme
  :ensure t
  :defer t)
#+END_SRC


*** Solarized 

#+BEGIN_SRC emacs-lisp :tangle no
(use-package solarized-theme
  :ensure t
  :defer t)
#+END_SRC


*** Sanityinc tomorrow

#+BEGIN_SRC emacs-lisp :tangle no
(use-package color-theme-sanityinc-tomorrow
  :ensure t
  :defer t)
#+END_SRC


*** Afternoon

#+BEGIN_SRC emacs-lisp :tangle no
(use-package afternoon-theme
  :ensure t
  :config 
  (load-theme 'afternoon t))
#+END_SRC


*** Theme looper

#+begin_src emacs-lisp :tangle no
(use-package theme-looper
  :defer t
  :bind ("S-<f12>" . theme-looper-enable-next-theme)
  :init
  (theme-looper-set-theme-set '(                               
                                leuven
                                tao-yang
                                anti-zenburn
                                 zenburn
                                cyberpunk
                                ;solarized-light
                                sanityinc-tomorrow-day
                                ))
  (theme-looper-set-customizations 'powerline-reset))
#+end_src


the function load-theme will first disable the active themes, before loading the new one.

#+BEGIN_SRC emacs-lisp :tangle no
(defun disable-all-themes ()
  "disable all active themes."
  (dolist (i custom-enabled-themes)
    (disable-theme i)))

(defadvice load-theme (before disable-themes-first activate)
  (disable-all-themes))
#+END_SRC


* Font

Download 

| [[https://github.com/adobe-fonts/source-code-pro][Source Code Pro]]     |
| [[https://www.fontsquirrel.com/fonts/download/dejavu-sans][Dejavu Sans]]         |
| [[https://fontlibrary.org/pt/font/fantasque-sans-mono][Fantasque Sans mono]] |
| [[http://leonardo-m.livejournal.com/77079.html][Inconsolata g]]       |



#+begin_src emacs-lisp
(set-frame-font "Source Code Pro 10")
;; (set-frame-font "Fira mono for powerline 10")
;; (set-frame-font "Monospace 10")
;; (set-frame-font "Dejavu Sans 10")
;; (set-frame-font "Fantasque Sans Mono 11")
;; (set-frame-font "Inconsolata-g 10")
#+end_src


* Common defaults

Sources for this section include [[https://github.com/magnars/.emacs.d/blob/master/settings/sane-defaults.el][Magnars Sveen]] and [[http://pages.sachachua.com/.emacs.d/Sacha.html][Sacha Chua]].

#+begin_src emacs-lisp
;; These functions are useful. Activate them.
(put 'downcase-region 'disabled nil)
(put 'upcase-region 'disabled nil)
(put 'narrow-to-region 'disabled nil)
(put 'dired-find-alternate-file 'disabled nil)

;; Answering just 'y' or 'n' will do
(defalias 'yes-or-no-p 'y-or-n-p)

;; UTF-8 please
(set-language-environment "UTF-8")
(setq locale-coding-system 'utf-8) ; pretty
(set-terminal-coding-system 'utf-8) ; pretty
(set-keyboard-coding-system 'utf-8) ; pretty
(set-selection-coding-system 'utf-8) ; please
(prefer-coding-system 'utf-8) ; with sugar on top
(setq default-buffer-file-coding-system 'utf-8)                      
(setq x-select-request-type '(UTF8_STRING COMPOUND_TEXT TEXT STRING))
;; from Sacha page
(when (display-graphic-p)
  (setq x-select-request-type '(UTF8_STRING COMPOUND_TEXT TEXT STRING)))
(setq-default indent-tabs-mode nil)

;; use shift-arrows to move between windows
(windmove-default-keybindings)

;; highlight current line
(global-hl-line-mode 1)

; wrap lines
(global-visual-line-mode)
(diminish 'visual-line-mode)

;; Turn off the blinking cursor
(blink-cursor-mode -1)

(setq-default indent-tabs-mode nil)
(setq-default indicate-empty-lines t)

;; Don't count two spaces after a period as the end of a sentence.
;; Just one space is needed.
(setq sentence-end-double-space nil)

;; delete the region when typing, just like as we expect nowadays.
(delete-selection-mode t)


(column-number-mode t)

;; convert symbols like greek letter into its unicode character
(setq global-prettify-symbols-mode t)
;; unprettify symbol when at right edge
(setq prettify-symbols-unprettify-at-point 'right-edge) 

(setq uniquify-buffer-name-style 'forward)


;; Don't beep at me
(setq visible-bell t)

;; Don't create backups
(setq make-backup-files nil)
#+end_src




*** Debug

#+BEGIN_SRC emacs-lisp :tangle no
;(setq debug-on-error t)
;(setq debug-on-quit t)
#+END_SRC


* Recentf
Recentf is a minor mode that builds a list of recently opened files.

#+begin_src emacs-lisp
(use-package recentf
  :defer 30
  :config
  (progn
    (recentf-mode t)
    (setq recentf-max-saved-items 200
          recentf-max-menu-items 15)))
#+end_src


* Org mode
*** Org itself


#+BEGIN_SRC emacs-lisp
(use-package org
  :ensure org-plus-contrib
  :load-path "~/.emacs.d/elpa/org-plus-contrib-20161102"
  :mode (("\\.org$" . org-mode))
  :bind(("C-c a" . org-agenda)
        ("C-c l" . org-store-link)
        ("C-c c" . org-capture))
  :config
  (add-hook 'org-mode-hook 'smartparens-mode)
  (add-hook 'org-mode-hook 'rainbow-delimiters-mode)
  (add-hook 'org-mode-hook 'company-mode)
  (add-hook 'org-mode-hook 'turn-on-org-cdlatex)
  (add-hook 'org-mode-hook 'flyspell-mode))
#+END_SRC


*** Images config

Start up folded, lists will be folded when file is opened. Don't remember where I got that.

#+BEGIN_SRC emacs-lisp
(use-package org
  :defer t
  :config
  (setq org-cycle-include-plain-lists 'integrate)
  (setq org-image-actual-width t)
  (setq org-startup-with-inline-images t))
 #+END_SRC
 

Org display inline images when starts up, [[http://emacs.stackexchange.com/questions/14758/in-org-mode-how-to-always-display-inline-images-at-emacs-startup][From this question]]. For change the width of images.
*** Org bullets

#+BEGIN_SRC emacs-lisp
(use-package org
  :defer t
  :config
  (use-package org-bullets
    :ensure t
    :config
    (add-hook 'org-mode-hook (lambda () (org-bullets-mode 1)))
    (setq org-ellipsis " …")
    (setq org-bullets-bullet-list '("•"))))
#+END_SRC


*** Org reveal

#+BEGIN_SRC emacs-lisp
(use-package org
  :defer t
  :config
  (use-package ox-reveal 
    :ensure t
    :defer 10
    :config
    (setq org-reveal-root "http://cdn.jsdelivr.net/reveal.js/3.0.0/")
    (setq org-reveal-mathjax t)))
#+END_SRC


*** Org beamer

#+BEGIN_SRC emacs-lisp
(use-package org
  :defer t
  :config
  (use-package ox-beamer
    :defer 10
    :config
    (progn
      ;; allow for export=>beamer by placing
      ;; #+LaTeX_CLASS: beamer in org files
      (add-to-list 'org-latex-classes
                   '("beamer"
                     "\\documentclass[presentation]{beamer}"
                     ("\\section{%s}"        . "\\section*{%s}")
                     ("\\subsection{%s}"     . "\\subsection*{%s}")
                     ("\\subsubsection{%s}"  . "\\subsubsection*{%s}"))))))
#+END_SRC


*** Org latex

#+BEGIN_SRC emacs-lisp
(use-package org
  :defer t
  :config
  (use-package ox-latex
    :defer 5
    :config
    ;; code highlight for latex org export
    (add-to-list 'org-latex-packages-alist '("" "minted"))
    ;; add a nice font to org latex export
    (add-to-list 'org-latex-packages-alist '("" "libertine"))

    ;; preview latex in org mode with imagemagick
    (setq org-latex-create-formula-image-program 'imagemagick)

    ;; For code fragments typesetting
    ;; http://orgmode.org/worg/org-tutorials/org-latex-preview.html
    (setq org-latex-listings 'minted))

    ; change foreground color of latex macros inside org
    (setq org-highlight-latex-and-related '(latex script entities))
    (set-face-foreground 'org-latex-and-related "blue")

    (setq doc-view-ghostscript-program "gswin64c")
)
#+END_SRC


*** Org block background

#+BEGIN_SRC emacs-lisp
(use-package org
  :defer t
  :config 
  (setq org-src-block-faces '(("emacs-lisp" (:background "GhostWhite"))
                            ("python" (:background "WhiteSmoke"))
                            ("ipython" (:background "AliceBlue"))
                            ("plantuml" (:background "Ivory"))
                            ("latex" (:background "FloralWhite"))
                            ("shell" (:background "Ivory")))))
#+END_SRC



*** Org download

#+BEGIN_SRC emacs-lisp
(use-package org
  :defer t
  :config
  (use-package org-download
   :ensure t
   :defer 10
   :config
   (setq-default org-download-image-dir "./img/")
   (setq-default org-download-heading-lvl nil)))
#+END_SRC


*** General options
Speed up commands. See the doc for speed keys by checking out [[elisp:(info%20"(org)%20speed%20keys")][the documentation for speed eys in Org mode]].

General options.
#+BEGIN_SRC emacs-lisp
(use-package org
  :defer t
  :config
  (setq org-special-ctrl-a/e t)
  (transient-mark-mode nil)
  (setq org-log-done 'time) ;Log the time a task is completed.
  (setq org-habit-graph-column 50) ;position the habit graph on the agenda to the right of he default
  (setq org-hide-emphasis-markers nil)
  (setq inhibit-splash-screen t)
  (setq org-indent-mode t) ;indent the headings for clean view
  (setq org-hide-leading-stars t) 
  (setq org-hide-leading-stars-before-indent-mode t)
  (setq org-odd-levels-only t)
  (diminish 'org-indent-mode)
  (setq org-startup-indented t)
  ;; (setq org-tags-column -66) ;where the tags are places
  (setq org-use-speed-commands t)


  ;; This is for remove the annoying background color on the headings, 
  ;; level 1 and level 2, when using the material-theme. 
  (custom-set-faces
   '(org-level-1 ((t (:background nil :bold t :overline nil))))
   '(org-level-2 ((t (:background nil :bold t :overline nil)))))


  (setq org-agenda-weekend-days nil)

  (setq org-modules '(org-habit))
  (eval-after-load 'org
    '(org-load-modules-maybe t))
    )
 #+END_SRC
 
 
*** Org babel config

#+BEGIN_SRC emacs-lisp
(use-package org
  :defer t
  :config
  (use-package ob
    :defer 10
    :config
    (add-hook 'org-mode-hook #'yas-minor-mode))

  (org-babel-do-load-languages
     'org-babel-load-languages
     '((python . t)
       (ipython . t)
       (emacs-lisp . t)
       (latex . t)
       (plantuml . t)
       (shell . t)))

  ;; plantuml jar file path
  (setq org-plantuml-jar-path
          (expand-file-name "~/.emacs.d/plantuml.jar"))

  (setq org-babel-default-header-args:python
        '((:results . "output pp")
          (:exports . "both")))

  ;; Org babel and source blocks
  (setq org-src-fontify-natively t
        org-highlight-latex-and-related '(latex)
        org-src-window-setup 'current-window
        org-src-strip-leading-and-trailing-blank-lines t
        org-src-preserve-indentation t ; preserve indentation in code
        org-adapt-indentation nil; Non-nil means adapt indentation to outline node level.
        org-src-tab-acts-natively t
        org-export-babel-evaluate nil
        org-confirm-babel-evaluate nil) ; doesn't ask for confirmation

  ;;; display/update images in the buffer after I evaluate
  (add-hook 'org-babel-after-execute-hook 'org-display-inline-images 'append))
#+END_SRC


*** Org ref

#+BEGIN_SRC emacs-lisp
(use-package org 
  :defer t
  :config
  (use-package org-ref
    :defer 20
    :ensure t
    :config
    (setq org-ref-default-bibliography 
          '("C:/Users/Nasser/OneDrive/Bibliography/references-zot.bib"))
    (setq org-ref-pdf-directory 
          '("C:/Users/Nasser/OneDrive/Bibliography/references-pdf/"
            "C:/Users/Nasser/OneDrive/Bibliography/references-etc/"))
            (setq org-ref-completion-library 'org-ref-ivy-bibtex)
            (org-ref-ivy-cite-completion)))
#+END_SRC



*** Todo sequences

#+BEGIN_SRC emacs-lisp
(use-package org
  :defer t
  :config
  (setq org-todo-keywords '((sequence "TODO(t)" "STRT(s)" "DONE(d)" "CNCL(c)")))

  (setq org-todo-keyword-faces 
        '(("TODO" :background "tomato" :foreground "#5f5f5f" :weight bold )
          ("STRT" :background "#edd400" :foreground "#5f5f5f" :weight bold )
          ("DONE" :background "#6ac214" :foreground "#5f5f5f" :weight bold )))
  
  (setq org-blank-before-new-entry '((heading . nil) (plain-list-item . nil)))
  (setq org-cycle-separator-lines 0)) 
#+END_SRC


From [[http://stackoverflow.com/questions/28351465/emacs-orgmode-do-not-insert-line-between-headers][This question]], an option for org mode not insert a line between headings.

[[http://orgmode.org/manual/Headlines.html][This reference]] is used to remove an annoying feature of not hiding extra lines in a subtree



*** Org Clock
From [[https://github.com/jbranso/.emacs.d/blob/master/lisp/init-org.org#my-org-capure-templates][this]] settings,

#+BEGIN_SRC emacs-lisp
(use-package org-clock
  :defer t
  :config
  ;; Save the running clock and all clock history when exiting Emacs, load it on startup
  (setq org-clock-persistence-insinuate t)
  (setq org-clock-persist t)
  (setq org-clock-in-resume t)

  ;; Change task state to STARTED when clocking in
  (setq org-clock-in-switch-to-state "STRT")
  ;; Save clock data and notes in the LOGBOOK drawer
  (setq org-clock-into-drawer t)
  ;; Removes clocked tasks with 0:00 duration
  (setq org-clock-out-remove-zero-time-clocks t))
#+END_SRC



*** Org paste from clipboard

Function for pasting images from clipboard. I got this from [[https://lists.gnu.org/archive/html/emacs-orgmode/2013-11/msg00290.html][this thread]]. It's very useful hen I'm writing notes while studying, great for reviewing the notes later.

+Now it creates a folder called "img/" where all the figures are going to be saved.+

#+BEGIN_SRC emacs-lisp
(use-package org
  :mode (("\\.org$" . org-mode))
  :bind ("C-c y" . my/org-insert-clipboard)
  :config
  (defun my/org-insert-clipboard ()
    (interactive)
    ;make the img directory
    (setq myvar/folder-path (concat default-directory "img/"))
    ;create the directory if it doesn't exist
    (if (not (file-exists-p myvar/folder-path))
        (mkdir myvar/folder-path))

    (let* ((image-file (concat 
                        myvar/folder-path
                        (buffer-name)
                        "_"
                        (format-time-string "%Y%m%d_%H%M%S_.png")))

           (exit-status
            (call-process "convert" nil nil nil
                          "clipboard:" image-file)))

      (org-insert-link nil (concat "file:" image-file) "")

      (org-display-inline-images))))
#+END_SRC


*** Org tree slide

#+BEGIN_SRC emacs-lisp
(use-package org-tree-slide
    :ensure t
    :bind (("<f9>" . org-tree-slide-mode)
           ("<f12>" . org-tree-slide-move-next-tree)
           ("<f11>" . org-tree-slide-move-previous-tree)
           ("C-<f12>" . org-babel-next-src-block)
           ("C-<f11>" . org-babel-previous-src-block))
    :config
    (global-set-key (kbd "S-<f9>") 'org-tree-slide-skip-done-toggle)
    (org-tree-slide-simple-profile)
    (setq org-tree-slide-modeline-display 'outside)

    (use-package hide-lines :ensure t)

    (defun my:hide-headers ()
      (interactive)
        (hide-lines-matching "#\\+BEGIN_SRC")
        (hide-lines-matching "#\\+END_SRC

"))
      (add-hook 'org-tree-slide-play-hook 'my:hide-headers)
      (add-hook 'org-tree-slide-stop-hook 'hide-lines-show-all)

    (defun my:show-headers ()
      (hide-lines-show-all))

    (defun advice:org-edit-src-code (&optional code edit-buffer-name)
      (interactive)
      (my:show-headers))
    (advice-add 'org-edit-src-code :before #'advice:org-edit-src-code)

    (defun advice:org-edit-src-exit ()
      (interactive)
      (my:hide-headers))
    (advice-add 'org-edit-src-exit :after #'advice:org-edit-src-exit)

    (advice-add 'org-edit-inline-src-code :after #'advice:org-edit-src-exit)
    (advice-add 'org-tree-slide-move-next-tree :after #'advice:org-edit-src-exit))
#+END_SRC


*** Org page

[[https://github.com/kelvinh/org-page][Org-page]] - A package for generate a static blog.

#+BEGIN_SRC emacs-lisp
(use-package org-page
  :ensure t
  :bind (("C-x C-a p" . op/do-publication-and-preview-site)
         ("C-x C-a C-p" . op/do-publication)
         ("C-x C-a C-n" . op/new-post))
  :config
  (setq op/repository-directory "c:/Users/Nasser/OneDrive/nasseralkmim.github.io/")
  (setq op/site-domain "http://nasseralkmim.github.io/")
  (setq op/personal-disqus-shortname "nasseralkmim")
  (setq op/site-main-title "Nasser Alkmim")
  (setq op/site-sub-title "~/-")
  (setq op/personal-github-link "https://github.com/nasseralkmim")
  (setq op/personal-google-analytics-id "74704246")

  (setq op/category-ignore-list '("themes" "assets" "blog"))

(setq op/category-config-alist
      '(("blog" ;; this is the default configuration
         :label "Notes"
         :show-meta t
         :show-comment t
         :uri-generator op/generate-uri
         :uri-template "/blog/%y/%m/%d/%t/"
         :sort-by :date     ;; how to sort the posts
         :category-index t) ;; generate category index or not
        ("index"
         :show-meta nil
         :show-comment nil
         :uri-generator op/generate-uri
         :uri-template "/"
         :sort-by :date
         :category-index nil)
        ("about"
         :show-meta nil
         :show-comment nil
         :uri-generator op/generate-uri
         :uri-template "/about/"
         :sort-by :date
         :category-index nil))))
#+end_src






* Shell

#+begin_src emacs-lisp
(bind-key "C-x m" 'shell)
(bind-key "C-x M" 'ansi-term)
#+end_src


* ELPA packages
*** Avy mode

[[https://github.com/abo-abo/avy][Avy-mode]]

#+BEGIN_SRC emacs-lisp
(use-package avy
  :ensure t 
  :diminish avy-mode
  :bind (("C-x C-SPC" . avy-goto-char)
         ("C-x C-x" . avy-goto-word-or-subword-1)
         ("C-x C-l" . avy-goto-line)))
#+END_SRC

*** Ace Window

[[https://github.com/abo-abo/ace-window][ace-window]] is a package that uses the same idea from ace-jump-mode for
buffer navigation, but applies it to windows. The default keys are
1-9, but it's faster to access the keys on the home row, so that's
what I have them set to (with respect to Dvorak, of course).

#+begin_src emacs-lisp
(use-package ace-window
  :ensure t 
  :config
  (setq aw-keys '(?a ?o ?e ?u ?h ?t ?n ?s))
  (ace-window-display-mode)
  (custom-set-faces
   '(aw-leading-char-face
     ((t (:inherit ace-jump-face-foreground :height 3.0)))))
  :bind ("C-o " . ace-window))
#+end_src

*** Counsel

#+BEGIN_SRC emacs-lisp
(use-package counsel
  :ensure t
  :bind (("M-x" . counsel-M-x)
         ("C-s" . counsel-grep-or-swiper)
         ("C-h v" . counsel-describe-variable)
         ("C-h f" . counsel-describe-function)
         ("C-x C-f" . counsel-find-file))
  :config
  (use-package smex :ensure t))
#+END_SRC


*** Ivy

#+BEGIN_SRC emacs-lisp
(use-package ivy
  :ensure t
  :diminish ivy-mode
  :bind (("C-x b" . ivy-switch-buffer))
  :config
  ;; Disable ido
  (with-eval-after-load 'ido
    (ido-mode -1)
    ;; Enable ivy
    (ivy-mode 1))
  ;; for recent candidates
  (setq ivy-use-virtual-buffers t)
  (setq ivy-display-style 'fancy)
  (setq ivy-count-format "(%d/%d) ")
  (setq ivy-initial-inputs-alist nil)
  (setq ivy-re-builders-alist '((t . ivy--regex-ignore-order)))

  ;; ;; Show recently killed buffers when calling ivy-switch-buffer
  (setq ivy-use-virtual-buffers t)
  ;; (setq ivy-virtual-abbreviate 'full) ; Show the full virtual file paths
  ;; ;; Do not show "./" and "../" in the counsel-find-file completion list
  (setq ivy-extra-directories nil))
#+END_SRC


*** Ivy Bibtex

=M-o= show the different actions 

#+BEGIN_SRC emacs-lisp
(use-package ivy-bibtex
  :ensure t
  :bind ("C-c b b" . ivy-bibtex)
  :config
  (setq bibtex-completion-bibliography 
        '("C:/Users/Nasser/OneDrive/Bibliography/references-zot.bib"))
  (setq bibtex-completion-library-path 
        '("C:/Users/Nasser/OneDrive/Bibliography/references-pdf"
          "C:/Users/Nasser/OneDrive/Bibliography/references-etc"))

  ;; using bibtex path reference to pdf file
  (setq bibtex-completion-pdf-field "File")

  ;;open pdf with external viwer foxit
  (setq bibtex-completion-pdf-open-function
        (lambda (fpath)
          (call-process "C:\\Program Files (x86)\\Foxit Software\\Foxit Reader\\FoxitReader.exe" nil 0 nil fpath)))

  (setq ivy-bibtex-default-action 'bibtex-completion-insert-citation))
#+END_SRC


*** Swiper

#+BEGIN_SRC emacs-lisp
(use-package swiper
  :ensure t
  :bind (("C-c u" . swiper-all)))
#+END_SRC



*** Magit


A great interface for git projects. It's much more pleasant to use
than the git interface on the command line. Use an easy keybinding to
access magit.

#+begin_src emacs-lisp
(use-package magit
  :ensure t 
  :bind ("C-c g" . magit-status)
  :config
  (define-key magit-status-mode-map (kbd "q") 'magit-quit-session)
  
  ;;This setting is needed to use ivy completion:
  (setq magit-completing-read-function 'ivy-completing-read)
  
  ;; full screen magit-status
  (defadvice magit-status (around magit-fullscreen activate)
    (window-configuration-to-register :magit-fullscreen)
    ad-do-it
    (delete-other-windows))

  (defun magit-quit-session ()
    "Restores the previous window configuration and kills the magit buffer"
    (interactive)
    (kill-buffer)
    (jump-to-register :magit-fullscreen)))
#+end_src


*** Projectile

#+begin_src emacs-lisp
(use-package counsel-projectile
  :ensure t
  :bind ("C-c p p " . counsel-projectile-switch-project)
  :config
  (counsel-projectile-on)
  (use-package projectile
    :ensure t 
    :diminish projectile-mode
    :init
    (projectile-global-mode)
    (setq projectile-completion-system 'ivy) ;So projectile works with ivy
    (setq projectile-indexing-method 'alien)))
 #+end_src
 
*** Python

Integrates with Python.

#+begin_src emacs-lisp
(use-package python
  :mode ("\\.py\\'" . python-mode)
  :interpreter ("python" . python-mode)
  :config
  (add-hook 'python-mode-hook 'anaconda-mode)
  (add-hook 'python-mode-hook 'anaconda-eldoc-mode)
  (add-hook 'python-mode-hook 'flycheck-mode)
  (add-hook 'python-mode-hook 'smartparens-mode)
  (add-hook 'python-mode-hook 'rainbow-delimiters-mode)
  (add-hook 'python-mode-hook 'company-mode)
  (add-hook 'python-mode-hook 'yas-minor-mode)

  (eval-after-load "company"
    '(add-to-list 'company-backends 'company-anaconda))


  ;; Sets the python interpreter to be ipython. To trick emacs into
  ;; thinking we're still running regular python, we run ipython in
  ;; classic mode.
  (setq
   python-shell-interpreter "ipython"
    python-shell-interpreter-args "-i --classic")

  ;; ;; Don't switch the code buffer to python shell
  (setq py-switch-buffers-on-execute-p nil)
  ;; ;; Split windows
  (setq py-split-windows-on-execute-p t)
  ;; ;; Try to automagically figure out indentation
  (setq py-smart-indentation t)

  (setq warning-suppress-types '((python)
                                 (emacs))))
#+end_src



*** +Elpy+

#+BEGIN_SRC emacs-lisp :tangle no
(use-package elpy
  :ensure t
  :defer t
  :config
  (elpy-enable)
  ;; (elpy-use-ipython)
  (setq elpy-rpc-backend "jedi"))
#+END_SRC

*** company mode
#+BEGIN_SRC emacs-lisp 
(use-package company
  :ensure t
  :defer t
  :config

  (use-package company-jedi :ensure t
    :disabled t
    :config
    (add-to-list 'company-backends 'company-jedi)
    (setq jedi:complete-on-dot t)
    (setq jedi:use-shortcuts t))

  )


#+END_SRC

*** Anaconda mode

#+BEGIN_SRC emacs-lisp
(use-package anaconda-mode
  :ensure t
  :bind ("C-c C-d" . anaconda-mode-show-doc)
)
#+END_SRC

*** Company anaconda

#+BEGIN_SRC emacs-lisp
(use-package company-anaconda 
  :ensure t
  :defer t)
#+END_SRC


*** Smartparens

#+begin_src emacs-lisp
(use-package smartparens
  :ensure t 
  :defer t
  :config
  (show-smartparens-global-mode t)
  (sp-local-pair 'org-mode "_" "_" )
  (sp-local-pair 'org-mode "*" "*" )
  (sp-local-pair 'latex-mode "$" "$" )
  (sp-local-pair 'latex-mode "\\left(" "\\right)" :trigger "\\l("))
#+end_src


*** AucTex


Enable [[https://www.gnu.org/software/auctex/manual/auctex.html][Auctex]] when files with .tex are loaded. Tex-master is  useful to make Auctex aware of multi-files documents. TeX-PDF mode is used to compile using pdflatex.

#+begin_src emacs-lisp
(use-package tex-site
  :ensure auctex
  :mode ("\\.tex\\'" . latex-mode)
  :config
  (setq TeX-auto-save t)
  (setq TeX-parse-self t)
  (setq-default TeX-master nil)
  (add-hook 'LaTeX-mode-hook
            (lambda ()
              (rainbow-delimiters-mode)
              (flyspell-mode)
              (company-mode)
              (smartparens-mode)
              (turn-on-reftex)
              (setq reftex-plug-into-AUCTeX t)
              (reftex-isearch-minor-mode)
              (setq TeX-PDF-mode t)
              (setq global-font-lock-mode t)))

  ;; Method for enabling forward and inverse search 
  (setq TeX-source-correlate-method 'synctex)
  ;; inhibit the question to start a server process
  (setq TeX-source-correlate-start-server t)

;; Update PDF buffers after successful LaTeX runs
  ;; http://emacs.stackexchange.com/questions/19472/how-to-let-auctex-open-pdf-with-pdf-tools
  (add-hook 'TeX-after-TeX-LaTeX-command-finished-hook
             #'TeX-revert-document-buffer)

  ;; to use pdfview with auctex
  (add-hook 'LaTeX-mode-hook 'pdf-tools-install)
 
  ;; latex commands
  (setq LaTeX-command "latex --synctex=1 -shell-escape")

  ;;Use pdf-tools to open PDF files
  (setq TeX-view-program-selection '((output-pdf "pdf-tools")))

  (setq TeX-view-program-list '(("pdf-tools" "TeX-pdf-tools-sync-view")))

  (setq pdf-sync-backward-display-action
  '(nil (reusable-frames . t)))
  (setq pdf-sync-forward-display-action
  '(nil (reusable-frames . t)))
)
#+end_src


*** Latex preview pane

shell-escape mode because the pacakge svg requires it.

#+BEGIN_SRC emacs-lisp :tangle no
(use-package latex-preview-pane
  :disabled t
  :bind ("M-p" . latex-preview-pane-mode)
  :config
  (setq doc-view-ghostscript-program "gswin64c")
  
  (custom-set-variables
   '(shell-escape-mode "-shell-escape")
   '(latex-preview-pane-multifile-mode (quote auctex))))
#+END_SRC


*** Reftex

[[http://www.gnu.org/software/auctex/manual/reftex.html#SEC2][RefTex website]]. Useful for managing cross references, bibliographies, indices, and document navigation.

#+BEGIN_SRC emacs-lisp
(use-package reftex
  :ensure t
  :defer t
  :config
  (setq reftex-cite-prompt-optional-args t) ; Prompt for empty optional arguments in cite
  ;; https://www.gnu.org/software/emacs/manual/html_mono/reftex.html
  (setq reftex-enable-partial-scans t)
  (setq reftex-keep-temporary-buffers nil)
  (setq reftex-save-parse-info t)
  (setq reftex-trust-label-prefix '("fig:" "eq:")))
#+END_SRC


*** +Magic Latex Buffer+

#+begin_src emacs-lisp :tangle no
(use-package magic-latex-buffer
  :load-path ("C:/Users/Nasser/.emacs.d/elpa/magic-latex-buffer-master")
  :config
  (add-hook 'LaTeX-mode-hook 'magic-latex-buffer)
  (setq magic-latex-enable-block-highlight nil
      magic-latex-enable-suscript        nil
      magic-latex-enable-pretty-symbols  t
      magic-latex-enable-block-align     nil
      magic-latex-enable-inline-image    nil))
#+end_src


*** Flycheck


#+BEGIN_SRC emacs-lisp
(use-package flycheck
  :ensure t 
  :defer t
  :config

  (flycheck-define-checker proselint
  "A linter for prose."
  :command ("proselint" source-inplace)
  :error-patterns
  ((warning line-start (file-name) ":" line ":" column ": "
        (id (one-or-more (not (any " "))))
        (message) line-end))
  :modes (text-mode markdown-mode gfm-mode))

  (add-to-list 'flycheck-checkers 'proselint)

  )
#+END_SRC


*** Flyspell

#+BEGIN_SRC emacs-lisp
(use-package flyspell
  :ensure t
  :bind ("S-<f6>" . flyspell-mode)
  :config
  
  ;; path to Aspell
  (add-to-list 'exec-path "C:/Program Files (x86)/Aspell/bin/")
  ;; use aspell
  (setq ispell-program-name "aspell")
  ;; where the dictionay is
  ;; (setq ispell-personal-dictionary "c:/Program Files (x86)/Aspell/dict")
  ;; change dictionaries
  (defun fd-switch-dictionary()
  (interactive)
  (let* ((dic ispell-current-dictionary)
    	 (change (if (string= dic "brasileiro") "english" "brasileiro")))
    (ispell-change-dictionary change)
    (message "Dictionary switched from %s to %s" dic change)
    ))
  (global-set-key (kbd "<f6>")   'fd-switch-dictionary)
  (global-set-key (kbd "C-<f1>") 'flyspell-correct-word-before-point)


  (use-package auto-dictionary
    :ensure t
    :config
    (add-hook 'flyspell-mode-hook (lambda () (auto-dictionary-mode 1))))
  
  (setq ispell-dictionary "brasileiro")
)
#+END_SRC


*** Company
Auto complete

The configurations were taken from [[https://github.com/company-mode/company-mode/issues/68][This discussion]]. The delay time from the wiki. This [[https://www.reddit.com/r/emacs/comments/3s5bkf/companymode_configuration_make_editing_slow/][reddit thread]] has some cool configurations. [[https://github.com/manugoyal/.emacs.d#company-mode][Company capf is problematic?]]

#+BEGIN_SRC emacs-lisp
(use-package company
  :ensure t
  :diminish company-mode
  :defer t
  :config
  (add-hook 'after-init-hook 'global-company-mode)
  (setq company-idle-delay 0)
  (setq company-show-numbers t)
  (setq company-minimum-prefix-length 3)
  (delete 'company-capf company-backends)
  (add-hook 'company-mode-hook 'company-statistics-mode)
  (use-package company-flx
    :ensure t
    :init
    (company-flx-mode +1)))
#+END_SRC


*** Company statistics-mode 

[[https://github.com/company-mode/company-statistics][Company statistics-mode]]

#+BEGIN_SRC emacs-lisp
(use-package company-statistics
  :ensure t
  :defer t)
#+END_SRC


*** Undo tree 


Undo system to recover any past state of a buffer.

#+BEGIN_SRC emacs-lisp
(use-package undo-tree
  :ensure t 
  :bind ("C-z" . undo-tree-undo)
  :diminish undo-tree-mode
  :config
  (progn
    (global-undo-tree-mode)
    (setq undo-tree-visualizer-diff t)))
#+END_SRC


*** Rainbow delimiters

#+BEGIN_SRC emacs-lisp
(use-package rainbow-delimiters
  :ensure t 
  :defer t
  :init   (add-hook 'prog-mode-hook #'rainbow-delimiters-mode)
  :config
  (set-face-foreground 'rainbow-delimiters-depth-1-face "dark slate gray")
  (set-face-foreground 'rainbow-delimiters-depth-2-face "brown")
  (set-face-foreground 'rainbow-delimiters-depth-3-face "deep sky blue")
  (set-face-foreground 'rainbow-delimiters-depth-4-face "magenta")
  (set-face-foreground 'rainbow-delimiters-depth-5-face "goldenrod")
  (set-face-foreground 'rainbow-delimiters-depth-6-face "lime green")
  (set-face-foreground 'rainbow-delimiters-depth-7-face "black")
  (set-face-foreground 'rainbow-delimiters-depth-8-face "cyan")
  (set-face-foreground 'rainbow-delimiters-depth-9-face "yellow")
  (set-face-foreground 'rainbow-delimiters-unmatched-face "red")
  )
#+END_SRC




*** Pdf tools

-From the larslj's  [[https://github.com/larslj/pdf-tools/tree/windows][windows branch]].- 

#+BEGIN_SRC emacs-lisp 
(use-package pdf-tools
  :mode ("\\.pdf\\'" . pdf-tools-install)
  :bind ("C-c C-g" . pdf-sync-forward-search)
  :config
  (setq mouse-wheel-follow-mouse t)
  (setq pdf-view-resize-factor 1.10))
#+END_SRC


*** +Which key+

#+BEGIN_SRC emacs-lisp :tangle no
(use-package which-key
  :ensure t
  :diminish (which-key-mode)
  :config
  (which-key-mode))
#+END_SRC




*** +Smart mode line+

#+BEGIN_SRC emacs-lisp :tangle no
(use-package smart-mode-line
  :ensure t
  :config
  (progn 
    (setq sml/no-confirmation-load-theme t)
    (sml/setup)))
#+END_SRC


*** +Writegood mode+

From [[https://github.com/grettke/help/blob/master/help.org][this source]]

#+BEGIN_SRC emacs-lisp :tangle no
(use-package writegood-mode
  :ensure t
  :config
  (eval-after-load "writegood-mode"
    '(diminish 'writegood-mode)))
#+END_SRC

*** Yasnippet

#+BEGIN_SRC emacs-lisp
(use-package yasnippet
  :commands (yas-minor-mode) ; autoload `yasnippet' when `yas-minor-mode' is called
                                        ; using any means: via a hook or by user
                                        ; Feel free to add more commands to this
                                        ; list to suit your needs.
  :config ; stuff to do after requiring the package
  (yas-reload-all)

    (defun yas/org-very-safe-expand ()
      (let ((yas/fallback-behavior 'return-nil)) (yas/expand)))

    (defun yas/org-setup ()
      ;; yasnippet (using the new org-cycle hooks)
      (make-variable-buffer-local 'yas/trigger-key)
      (setq yas/trigger-key [tab])
      (add-to-list 'org-tab-first-hook 'yas/org-very-safe-expand)
      (define-key yas/keymap [tab] 'yas/next-field))

    ;; See https://github.com/eschulte/emacs24-starter-kit/issues/80.
    (setq org-src-tab-acts-natively nil)
    
    (add-hook 'org-mode-hook #'yas/org-setup))
#+END_SRC


*** +Hyperbole+

#+BEGIN_SRC emacs-lisp :tangle no
(use-package hyperbole
  :ensure t
  :defer 10)
#+END_SRC

*** +Lispy+

#+BEGIN_SRC emacs-lisp :tangle no
(use-package lispy
  :ensure t
  :defer t)
#+END_SRC

*** Key chord

#+BEGIN_SRC emacs-lisp
(use-package key-chord
  :ensure t
  :defer 10
  :config
  (key-chord-mode 1)
  (setq key-chord-two-keys-delay 0.1)
  (key-chord-define-global "]]" "\\")
  (key-chord-define-global ";;" "/")
  (key-chord-define-global "::" "?")
  (key-chord-define-global "}}" "|"))
#+END_SRC

*** Neotree

#+BEGIN_SRC emacs-lisp
(use-package neotree
  :ensure t
  :bind ("<f8>" . neotree-toggle)
  :config
  (setq neo-smart-open t)
  (setq neo-vc-integration nil)
  ;; Do not allow neotree to be the only open window
  (setq-default neo-dont-be-alone t)
  (setq neo-theme 'nerd)) ; 'classic, 'nerd, 'ascii, 'arrow
#+END_SRC



*** +Hydra+

#+BEGIN_SRC emacs-lisp :tangle no
(use-package hydra
  :ensure t
  :config
  (set-face-attribute 'hydra-face-red      nil :foreground "Red"        :bold t)
  (set-face-attribute 'hydra-face-blue     nil :foreground "RoyalBlue3" :bold t)
  (set-face-attribute 'hydra-face-amaranth nil :foreground "#e52b50"    :bold t)
  (set-face-attribute 'hydra-face-pink     nil :foreground "HotPink1"   :bold t)
  (set-face-attribute 'hydra-face-teal     nil :foreground "#367588"    :bold t)
  (hydra-add-font-lock))
#+END_SRC

*** imenu list


#+BEGIN_SRC emacs-lisp
(use-package imenu-list
  :ensure t
  :bind ("C-." . imenu-list-minor-mode)
  :config
  (setq imenu-list-focus-after-activation t))
#+END_SRC

*** Expand region

#+BEGIN_SRC emacs-lisp
(use-package expand-region
  :ensure t
  :bind ("C-=" . er/expand-region))
#+END_SRC

*** Iedit

#+BEGIN_SRC emacs-lisp
(use-package iedit
  :ensure t
  :bind* ("C-;" . iedit-mode))
#+END_SRC

* Misc
** +Doc view keybindings+

#+begin_src emacs-lisp :tangle no
(use-package doc-view
  :config
  (add-hook 'doc-view-mode-hook (lambda () (centered-cursor-mode -1)))
  (define-key doc-view-mode-map (kbd "<right>") 'doc-view-next-page)
  (define-key doc-view-mode-map (kbd "<left>") 'doc-view-previous-page)
  (setq mouse-wheel-progressive-speed nil) ;; don't accelerate scrolling
  (setq mouse-wheel-follow-mouse 't) ;; scroll window under mouse

  (global-set-key (kbd "C-<wheel-up>") 'doc-view-enlarge)
  (global-set-key (kbd "C-<wheel-down>") 'doc-view-shrink)

  (setq doc-view-continuous t))
#+end_src


** Remove ad-handle message
#+BEGIN_SRC emacs-lisp
(setq ad-redefinition-action 'accept)
#+END_SRC

** Winner mode
#+BEGIN_SRC emacs-lisp
(winner-mode 1)
#+END_SRC



** Autorevert mode

Update file in buffer, refresh.

#+BEGIN_SRC emacs-lisp 
(global-auto-revert-mode t)
(setq global-auto-revert-non-file-buffers t)
(setq auto-revert-verbose nil)
#+END_SRC

** Key M-\ to M-] delete horizontal space

#+BEGIN_SRC emacs-lisp
(global-set-key (kbd "M-]") 'delete-horizontal-space)
#+END_SRC

** minibuffer

Minibuffer window expands vertically as necessary to hold the text
that you put in the minibuffer

#+BEGIN_SRC emacs-lisp
(setq resize-mini-windows t) ;; was grow-only
#+END_SRC

** Activate window on another frame

mouse auto select to make active the buffer where the mouse pointer is hovering, and focus follows to work with other emacs frames. Useful to scroll pdf on different frames

#+BEGIN_SRC emacs-lisp :tangle no
(setq focus-follows-mouse t)
(setq mouse-autoselect-window t)
#+END_SRC


** Scrooling

#+BEGIN_SRC emacs-lisp
(setq mouse-wheel-progressive-speed nil) ;; don't accelerate scrolling
(setq mouse-wheel-follow-mouse 't) ;; scroll window under mouse
#+END_SRC















































